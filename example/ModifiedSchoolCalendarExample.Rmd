---
  title: "Konstantopolous (2011) Modified school calendar"
---



We consider the  data in Konstantopoulos (2011), where the  effect of a modified school calendar (with more frequent but shorter breaks) on student achievement is examined. The meta-analysis uses studies of $n=56$ schools in 11 districts.  The experimental design is a two-group comparison (modified calendar vs traditional
calendar) which involves computing the standardized mean difference
$X_i \sim N(\theta_i,1)$, where $\theta_i>0$ indicates a positive effects, i.e. a higher level of achievement in the
group following the modified school calendar.

We analyze the data by providing CIs on the selected schools with a two-sided $p$-value at most 0.05. 





```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(xtable)
library(DirectedCI)

```

Importing data from the R package `metafor `:

# The data 
```{r, eval = TRUE}
#install.packages("metafor")
library("metafor")
dat <- get(data(dat.konstantopoulos2011))
x <- as.vector(dat$yi / sqrt(dat$vi))
m <- length(x)
p_right_tail <- pnorm(x, lower.tail = FALSE)
alpha = 0.05
S= which(p_right_tail<=alpha/2 | p_right_tail>=1-alpha/2)
p_right_tail[S]
length(S)
y.mean =  as.vector(dat$yi)[S]
y.SE = as.vector(sqrt(dat$vi))[S]

```


# The 21 selected 



```{r, eval = TRUE}


#order by effect size

o = order(y.mean)#order(log(dat$y))
oS = S[o]

omean = y.mean[o]#log(dat$y)[o]
oSE = y.SE[o]
 

alpha = 0.05

# PP with 1.3*SE length
r = 1.3

L.ppCond.r = U.ppCond.r =L.ppBY.r = U.ppBY.r = rep(NA,length(omean))
for (i in 1:length(omean)){
    #BY05-adjusted marginal DP+
    out = pp_marginal_ci(y = omean[i]/oSE[i],  r_l = 1.3, alpha = length(S)*alpha/m)
    L.ppBY.r[i] = out[1]*oSE[i]
    U.ppBY.r[i] = out[2]*oSE[i]
}  
 
round(cbind(L.ppBY.r, U.ppBY.r),3)



for (i in 1:length(omean)){
    print(i)
    #Conditional DP+
    out = pp_conditional_ci(y=omean[i]/oSE[i], r = 1.3, ct=qnorm(1-alpha/2), alpha=alpha)
    L.ppCond.r[i] = out[1]*oSE[i]
    U.ppCond.r[i] = out[2]*oSE[i]
}  

round(cbind(L.ppCond.r, U.ppCond.r),3)

tab = cbind(oS, omean, oSE,round(L.ppBY.r,3), round(U.ppBY.r,3),round(L.ppCond.r,3), round(U.ppCond.r,3))
colnames(tab) = c("study", "mean effect", "SE", "L-BY05", "U-BY05", "L-cond", "U-cond")
print(tab)


```
